# QuickChain - Project Context for Claude

## Project Overview

QuickChain is a web application that allows users to view email chains from `.msg` files in chronological order. It provides a drag-and-drop interface for loading Outlook message files and displays them in a clean, chronological view with full headers, body content, and attachment information.

## Technology Stack

- **Frontend**: Vanilla JavaScript (ES6 modules)
- **Build Tool**: Vite 5.0
- **Dev Server**: Vite dev server (port 3000)
- **Dependencies**:
  - `@kenjiuno/msgreader` - Parses .msg files
  - `vite-plugin-node-polyfills` - Provides Node.js polyfills for Buffer, global, and process

## Project Structure

```
QuickChain/
├── index.html           # Main HTML file with app structure
├── package.json         # Dependencies and scripts
├── vite.config.js       # Vite configuration with Node polyfills
├── js/                  # JavaScript modules
│   ├── app.js          # Main application controller
│   ├── emailChain.js   # Email chain management and rendering
│   ├── msgParser.js    # .msg file parsing logic
│   ├── queue.js        # File processing queue
│   └── toast.js        # Toast notification system
├── css/
│   └── styles.css      # Application styles
└── assets/             # Built assets (generated by Vite)
```

## Core Architecture

### Module Responsibilities

1. **app.js** (`QuickChainApp` class)
   - Main application controller
   - Initializes DOM elements and event listeners
   - Handles drag-and-drop file operations
   - Manages file processing workflow
   - Coordinates between queue, parser, and email chain

2. **emailChain.js** (`EmailChain` class)
   - Manages the collection of emails using a Map for deduplication
   - Sorts emails chronologically (earliest first)
   - Renders email cards with headers, body, and attachments
   - Handles XSS prevention via HTML escaping
   - Toggles UI between empty state and email list

3. **msgParser.js**
   - Uses `@kenjiuno/msgreader` library
   - Parses .msg files and extracts metadata
   - Converts HTML body to plain text
   - Handles attachments and nested .msg files
   - Returns standardized email objects

4. **queue.js** (`ProcessingQueue` class)
   - Manages asynchronous file processing queue
   - Displays queue status and progress
   - Processes one file at a time
   - Provides visual feedback during processing

5. **toast.js** (`ToastManager` class)
   - Displays temporary notifications
   - Supports error and info messages
   - Auto-dismisses after timeout
   - Provides manual close functionality

### Key Features

- **Drag & Drop**: Users can drop .msg files anywhere in the app
- **Chronological Ordering**: Emails sorted by send time (earliest first)
- **Duplicate Detection**: Uses combination of date, subject, from, and body preview as unique identifier
- **Processing Queue**: Visual feedback for multiple file uploads
- **Full Headers**: Displays From, To, Cc, Date, and Subject
- **Attachment List**: Shows attachment names (files not extracted)
- **Plain Text Display**: HTML emails converted to plain text
- **Error Handling**: Toast notifications for parsing errors
- **Clear All**: Resets application with confirmation dialog

## Code Conventions

### JavaScript Style
- ES6 modules with explicit imports/exports
- Class-based architecture with single responsibility
- JSDoc comments for methods
- Descriptive method names (e.g., `generateEmailId`, `handleFiles`)
- Consistent error handling with try-catch blocks

### DOM Manipulation
- Direct DOM element references stored in instance properties
- Event delegation where appropriate
- classList for CSS class toggling
- innerHTML for complex template rendering
- textContent for XSS-safe text insertion

### Security
- HTML escaping for all user-provided content
- XSS prevention in emailChain.js via `escapeHtml()` method
- File type validation (only .msg files accepted)

## Development Workflow

### Running the App
```bash
npm install          # Install dependencies
npm run dev          # Start dev server (port 3000)
npm run build        # Build for production
npm run preview      # Preview production build
```

### Committing Changes
**IMPORTANT**: Before every commit and push, you MUST update the commit date in `index.html`:

1. Get the current date/time using: `git log -1 --format="%cd" --date=format:"%I:%M%p on %B %d, %Y"`
2. Update the commit date in the `.commit-date` div in `index.html` (line ~16)
3. Format: "Commit date: HH:MM(AM/PM) on Month DD, YYYY"

This ensures the live app displays the correct version information to users.

### Build Configuration
- Base path: `/QuickChain/` (configured for GitHub Pages)
- Output directory: `dist/`
- Development server runs on port 3000
- Auto-opens browser on dev server start

## Important Implementation Details

### Email Deduplication
Emails are deduplicated using a composite key:
```javascript
const emailId = [
    email.date?.toISOString() || '',
    email.subject || '',
    email.from || '',
    (email.body || '').substring(0, 100)
].join('|||');
```

### Chronological Sorting
Emails are sorted in ascending order (earliest first):
```javascript
emailArray.sort((a, b) => {
    const dateA = a.date || new Date(0);
    const dateB = b.date || new Date(0);
    return dateA - dateB;
});
```

### Node.js Polyfills
Required for `@kenjiuno/msgreader` to work in browser:
- Buffer
- global
- process

These are provided by `vite-plugin-node-polyfills` configured in `vite.config.js`.

## UI/UX Patterns

1. **Empty State**: Large drop zone shown when no emails loaded
2. **Active State**: Email list with smaller drag overlay
3. **Queue Feedback**: Visual indicator showing processing status
4. **Toast Notifications**: Non-intrusive error messages
5. **Confirmation Dialogs**: Used for destructive actions (Clear All)

## Common Tasks

### Adding a New Feature
1. Identify the appropriate module (app, emailChain, queue, toast, msgParser)
2. Add method to the relevant class
3. Update event listeners in app.js if UI interaction needed
4. Test with multiple .msg files

### Modifying Email Display
- Edit `emailChain.js` methods: `createEmailElement`, `createHeaderHtml`, `createBodyHtml`, `createAttachmentsHtml`
- Update corresponding CSS in `css/styles.css`

### Changing Parsing Logic
- Modify `msgParser.js`
- Ensure returned email object maintains expected structure: `{ from, to, cc, date, subject, body, attachments }`

### Adjusting Queue Behavior
- Edit `queue.js` ProcessingQueue class
- Update UI elements in `index.html` if needed

## Known Limitations

1. **Attachment Access**: Attachments are listed but not extracted/downloadable
2. **HTML Rendering**: HTML emails converted to plain text (no rich formatting)
3. **Large Files**: No progress bar for individual large .msg files
4. **Browser Support**: Requires modern browser with ES6 module support

## Testing Considerations

- Test with various .msg file sizes
- Test with emails containing different header combinations
- Test with emails containing attachments
- Test with duplicate email files
- Test with invalid files to verify error handling
- Test with multiple files in queue
- Test drag-and-drop in both empty and active states

## Deployment

### GitHub Pages Setup

The app is configured for GitHub Pages with base path `/QuickChain/`.

**Automatic Deployment:**
A GitHub Actions workflow (`.github/workflows/deploy.yml`) automatically builds and deploys the app when changes are pushed to the `main` branch.

**First-time Setup:**
1. Go to your GitHub repository Settings → Pages
2. Under "Build and deployment", set Source to "GitHub Actions"
3. Push changes to the `main` branch to trigger deployment
4. The workflow will build the app and deploy to GitHub Pages automatically

**Manual Deployment:**
If needed, you can manually deploy by:
1. Running `npm run build` to create the `dist/` folder
2. Using `git subtree push --prefix dist origin gh-pages` to push only the dist folder to gh-pages branch
3. Ensure GitHub Pages is configured to serve from the gh-pages branch

Built files in `dist/` directory are ready to be served by any static hosting provider.
